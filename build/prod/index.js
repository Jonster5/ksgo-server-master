"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=e(require("ws"));const t=process.env.PORT||4e3,s=new n.default.Server({port:parseInt(`${t}`)}),o=[],c=[];console.clear(),s.on("connection",((e,t)=>{e.on("close",(t=>{if(c.find((n=>n.socket===e))){const t=c.find((n=>n.socket===e));c.splice(c.indexOf(t),1);const s=o.map((({id:e})=>e));o.forEach((({socket:e})=>{e.readyState===n.default.OPEN&&e.send(JSON.stringify({id:"user-serverlist",content:s}))})),console.info(`Server disconnected: ${t.id}`)}else{const n=o.find((n=>n.socket===e));o.splice(o.indexOf(n),1),console.info(`User disconnected: ${n.id}`)}})),e.on("message",(t=>{const{id:s,content:i}=JSON.parse(t);if("server-connect"===s){const{name:t,address:s}=i;let r=Math.random().toString().slice(2,7);for(;c.some((e=>e.id===r));)r=Math.random().toString().slice(2,7);c.push({id:r,name:t,address:s,socket:e}),e.send(JSON.stringify({id:"server-connect-confirm",content:r}));const d=c.map((({name:e,id:n})=>({name:e,id:n})));o.forEach((({socket:e})=>{e.readyState===n.default.OPEN&&e.send(JSON.stringify({id:"user-serverlist-update",content:d}))})),console.info(`Server connected ${r}`)}else if("user-connect"===s){const{name:n}=i;let t=Math.random().toString().slice(2,10);for(;o.some((({id:e})=>e===t));)t=Math.random().toString().slice(2,10);o.push({id:t,name:n,socket:e}),e.send(JSON.stringify({id:"user-connect-confirm",content:t}));const s=c.map((({name:e,id:n})=>({name:e,id:n})));e.send(JSON.stringify({id:"user-serverlist-update",content:s})),console.info(`User connected: ${t}`)}}))}));
